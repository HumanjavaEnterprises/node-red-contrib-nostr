<script type="text/html" data-template-name="nostr-filter">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-filterType"><i class="fa fa-filter"></i> Filter Type</label>
        <select id="node-input-filterType">
            <option value="kind">Event Kind</option>
            <option value="tag">Tag</option>
            <option value="since">Time Since</option>
            <option value="custom">Custom</option>
        </select>
    </div>
    <div class="form-row filter-kind">
        <label for="node-input-eventKinds"><i class="fa fa-list"></i> Event Kinds</label>
        <select id="node-input-eventKinds" multiple>
            <option value="0">Metadata (0)</option>
            <option value="1">Text Note (1)</option>
            <option value="3">Contacts (3)</option>
            <option value="4">DM (4)</option>
            <option value="6">Repost (6)</option>
            <option value="7">Reaction (7)</option>
            <option value="9735">Zap (9735)</option>
        </select>
    </div>
    <div class="form-row filter-tag">
        <label for="node-input-tagName"><i class="fa fa-tag"></i> Tag Name</label>
        <input type="text" id="node-input-tagName" placeholder="e, p, t, etc">
    </div>
    <div class="form-row filter-tag">
        <label for="node-input-tagValue"><i class="fa fa-tag"></i> Tag Value</label>
        <input type="text" id="node-input-tagValue" placeholder="Tag value to match">
    </div>
    <div class="form-row filter-since">
        <label for="node-input-sinceMinutes"><i class="fa fa-clock-o"></i> Minutes</label>
        <input type="number" id="node-input-sinceMinutes" placeholder="Time window in minutes">
    </div>
    <div class="form-row filter-custom">
        <label for="node-input-customFilter"><i class="fa fa-code"></i> Custom Filter</label>
        <input type="text" id="node-input-customFilter" placeholder='{"kinds":[1],"#e":["..."]}'>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('nostr-filter', {
        category: 'protocol',
        color: '#a6bbcf',
        defaults: {
            name: { value: "" },
            filterType: { value: "kind" },
            eventKinds: { value: [1] },
            tagName: { value: "" },
            tagValue: { value: "" },
            sinceMinutes: { value: 60 },
            customFilter: { value: "{}" }
        },
        inputs: 1,
        outputs: 1,
        icon: "filter.png",
        label: function() {
            return this.name || "Nostr Filter";
        },
        oneditprepare: function() {
            $("#node-input-filterType").on("change", function() {
                $(".filter-kind, .filter-tag, .filter-since, .filter-custom").hide();
                $(".filter-" + $(this).val()).show();
            });
            $("#node-input-filterType").trigger("change");
        }
    });
</script>

<script type="text/html" data-help-name="nostr-filter">
    <p>Filters Nostr events based on various criteria.</p>

    <h3>Filter Types</h3>
    <dl class="message-properties">
        <dt>Event Kind</dt>
        <dd>Filter by Nostr event kinds (text notes, reactions, etc)</dd>
        
        <dt>Tag</dt>
        <dd>Filter by specific tag name and value</dd>
        
        <dt>Time Since</dt>
        <dd>Only show events from the last X minutes</dd>
        
        <dt>Custom</dt>
        <dd>Apply a custom JSON filter</dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload</dt>
        <dd>Events that match the filter criteria</dd>
    </dl>
</script>
